# ====================================================================
# Email Parser Service - Environment Configuration
# ====================================================================
#
# This service monitors email for Pickle Planner reservation emails
# and makes them available to the kiosk application.
#
# Uses Microsoft Graph API for OAuth2-based authentication and mailbox-level security.
# See GRAPH_API_SETUP.md for complete setup instructions.
#
# ====================================================================

# ====================================================================
# Azure Key Vault Configuration (Recommended for Production)
# ====================================================================
# Secrets are loaded from Azure Key Vault on startup.
# If Key Vault is not configured, falls back to environment variables below.
#
# The following 4 values are needed to authenticate with Key Vault:
# AZURE_TENANT_ID=d5d907fc-f592-4dfc-b9ab-c3e058091aaf
# AZURE_CLIENT_ID=07e5683f-6db2-4d3c-bb4e-dd0cab73e20e
# AZURE_CLIENT_SECRET=<your-service-principal-secret>
AZURE_KEYVAULT_URL=https://pickleballkioskvault.vault.azure.net/
#
# Key Vault secrets used by this service:
# - graph-tenant-id: Microsoft Graph API Tenant ID
# - graph-client-id: Microsoft Graph API Client ID
# - graph-client-secret: Microsoft Graph API Client Secret
# - graph-user-id: Email address to check for reservations
# - azure-openai-endpoint: Azure OpenAI resource endpoint URL
# - azure-openai-api-key: Azure OpenAI API key
# - azure-openai-deployment: Model deployment name (optional, defaults to gpt-4o-mini)
# ====================================================================

# --------------------------------------------------------------------
# Fallback: Microsoft Graph API Configuration (used if Key Vault not configured)
# --------------------------------------------------------------------
# Provides OAuth2-based authentication and mailbox-level security.
# See GRAPH_API_SETUP.md for complete setup instructions.
#
# To use Graph API, uncomment and configure these variables:

# GRAPH_TENANT_ID=your-tenant-id
# GRAPH_CLIENT_ID=your-client-id
# GRAPH_CLIENT_SECRET=your-client-secret
# GRAPH_USER_ID=your-email@example.com

# --------------------------------------------------------------------
# Azure OpenAI Configuration (used if Key Vault not configured)
# --------------------------------------------------------------------
# Used to parse reservation emails using AI

# AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
# AZURE_OPENAI_API_KEY=your-api-key
# AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4o-mini

# --------------------------------------------------------------------
# Logging Configuration
# --------------------------------------------------------------------
# Log level: error, warn, info, debug (default: info)
# In development, logs are pretty-printed to console
# In production (NODE_ENV=production), logs are JSON format for rsyslog
LOG_LEVEL=info

# --------------------------------------------------------------------
# Application Insights (Optional)
# --------------------------------------------------------------------
# Azure Application Insights connection string for centralized logging
# Get this from Azure Portal > Application Insights > Overview > Connection String
# When set, logs, requests, exceptions, and dependencies are sent to Azure
# APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=xxx;IngestionEndpoint=https://xxx.in.applicationinsights.azure.com/

# --------------------------------------------------------------------
# Service Configuration
# --------------------------------------------------------------------

# How often to check for new emails (in minutes)
# Default: 1 minute (fast updates)
EMAIL_CHECK_INTERVAL=1

# Feature flag to enable/disable email polling
# Set to "true" to enable email polling, "false" to disable
# When disabled, the service will still run but won't poll emails and will return empty reservation lists
ENABLE_EMAIL_POLLING=true

# Port for the email-parser service
PORT=3002

# --------------------------------------------------------------------
# Redis Configuration
# --------------------------------------------------------------------

# Redis connection URL
# Default: redis://localhost:6379
# Docker: redis://redis:6379
REDIS_URL=redis://localhost:6379

# --------------------------------------------------------------------
# Notes
# --------------------------------------------------------------------
#
# Reservation Storage:
# - Reservations are stored in Redis with 7-day TTL
# - Automatic cleanup of past reservations runs hourly
# - Reservation index maintained for fast queries
#
# Email Processing:
# - Only "Rally Club Reservation" emails are processed
# - Emails are marked as read after processing
# - Duplicate reservations are automatically detected and skipped
#
# Security:
# - Recommended: Use Azure Key Vault for all secrets in production
# - Graph API: Client secrets should be kept secure
# - Redis: No authentication by default (add password for production)
#
# For detailed setup and troubleshooting, see:
# - GRAPH_API_SETUP.md (Microsoft Graph API setup)
# - README.md (Email parser documentation)
